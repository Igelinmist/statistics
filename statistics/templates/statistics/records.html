{% extends "base.html" %}
{% load statistics_extras %}
{% block content %}
    <h2>Журнал статистики</h2>
    <strong>Оборудование: </strong>
    <h3>{{ journal.equipment }}</h3>
    <strong>Накопленная статистика:</strong>
    Наработка: {{ journal|sum_stat:'wd' }}, остановов: {{ journal|sum_stat:'ost' }}, пусков: {{ journal|sum_stat:'psk' }}
    <h3>Записи журнала работы</h3>

    <nav>
        <ul class="pagination">
            {% if records.has_previous %}
                <li>
                    <a href="?page={{ records.previous_page_number }}" aria-label="Previous">
                        <span aria-hidden="true">&laquo;</span>
                    </a>
                </li>
            {% endif %}
                <li>
                    <span class="current">
                        страница {{ records.number }} из {{ records.paginator.num_pages }}
                    </span>
                </li>
            {% if records.has_next %}
                <li>
                    <a href="?page={{ records.next_page_number }}" aria-label="Next">
                        <span aria-hidden="true">&raquo;</span>
                    </a>
                </li>
            {% endif %}
        </ul>
    </nav>

    <table class="table table-condensed">
        <tr>
            <th>Дата</th>
            <th>Работа</th>
            {% if journal.stat_by_parent %}
                <th></th>
            {% else %}
                <th></th>
            {% endif %}
        </tr>
        {% for rec in records %}
        <tr>
            <td>{{ rec.date }}</td>
            <td>{{ rec.work|interval }}</td>
            {% if journal.stat_by_parent %}
                <td></td>
            {% else %}
                {% if user.is_authenticated %}
                    <td>
                        <a href="{% url 'statistics:record_edit' journal.id rec.id %}" class="btn btn-primary">Править</a>
                        <a href="{% url 'statistics:record_delete' journal.id rec.id %}" class="btn btn-danger">Удалить</a>
                    </td>
                {% endif %}
            {% endif %}
        </tr>
        {% endfor %}
    </table>
    {% if not journal.stat_by_parent and user.is_authenticated%}
        <a href="{% url 'statistics:record_new' journal.id %}" class="btn btn-success">Добавить запись</a><br />
    {% endif %}


{% endblock content %}