{% extends "base.html" %}
{% load statistics_extras %}
{% block content %}
    <h2>Журнал статистики</h2>
    <strong>Оборудование: </strong>
    <h3>{{ journal.equipment }}</h3>
    <strong>Накопленная статистика:</strong>
    Наработка: {{ journal|sum_stat:'wd' }}, остановов: {{ journal|sum_stat:'ost' }}, пусков: {{ journal|sum_stat:'psk' }}
    <h3>Записи журнала работы</h3>
    <table class="table table-condensed">
        <tr>
            <th>Дата</th>
            <th>Работа</th>
            {% if journal.stat_by_parent %}
                <th></th>
            {% else %}
                <th></th>
            {% endif %}
        </tr>
        {% for rec in record_list %}
        <tr>
            <td>{{ rec.date }}</td>
            <td>{{ rec.work|interval }}</td>
            {% if journal.stat_by_parent %}
                <td></td>
            {% else %}
                {% if user.is_authenticated %}
                    <td>
                        <a href="{% url 'statistics:record_edit' journal.id rec.id %}" class="btn btn-primary">Править</a>
                        <a href="{% url 'statistics:record_delete' journal.id rec.id %}" class="btn btn-danger">Удалить</a>
                    </td>
                {% endif %}
            {% endif %}
        </tr>
        {% endfor %}
    </table>
    {% if not journal.stat_by_parent and user.is_authenticated%}
        <a href="{% url 'statistics:record_new' journal.id %}" class="btn btn-success">Добавить запись</a><br />
    {% endif %}
    <h3>Записи событий</h3>
    <table class="table table-condensed">
        <tr>
            <th>Дата</th>
            <th>Событие</th>
            <th></th>
        </tr>
        {% for event in event_list %}
            <tr>
                <td>{{ event.date }}</td>
                <td>{{ event.event|human_event }}</td>
                <td><a href="{% url 'statistics:event_delete' journal.id event.id %}" class="btn btn-danger">Удалить</a></td>
            </tr>
        {% endfor %}
    </table>
    {% if user.is_authenticated %}
        <form action="{% url 'statistics:event_new' journal.id %}" method="post">
            {% csrf_token %}
            {{ form }}
        <input type="submit" value="Добавить" class="btn btn-success"/>
        </form>
    {% endif %}
    <a href="{% url 'statistics:index' %}" class="btn btn-primary">к журналам</a>
{% endblock content %}